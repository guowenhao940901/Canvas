<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/common.css">
    <title>Document</title>
    <style>
        html,body{
             width: 100%;
             height:100%;
        }
        .main{
             width:100%;
             height:100%;
        }
    </style>
</head>
<body> 
        <div class="main" id="main">

        </div>
        <script src="js/echarts.min.js"></script>
        <script src="js/bmap.js"></script>
        <script src="http://api.map.baidu.com/api?v=2.0&ak=f99kAEYGls7AOagGUFFBkgwb"></script>
        <script src="js/zepto.min.js"></script>
        <script>
                var myChart = echarts.init(document.getElementById('main'));
               function drawHeartMap(){
                var option = {
                    baseOption: {
                        title:{
                            text: "北京动物园扫描人数的实时监控",
                            // subtext: "数据模拟,仅为测试",
                            left: 'center',
                            top: 20,
                            textStyle:{
                                color: 'white',
                                fontSize: 20
                            },
                            subtextStyle:{
                                color: 'white',
                                fontSize: 16
                            }
                        },
                        timeline: {
                            // autoPlay:true,
                            //data: ["2018-05-15 00:00","2018-05-17 00:00"],
                            // axisType: 'category',
                            // padding: [5,5,5,5],
                            // playInterval:1500,
                            // lineStyle:{color:'white'},
                            // label:{
                            //     normal:{
                            //         textStyle:{
                            //             color: 'white',
                            //             fontSize: 18
                            //         }
                            //     }
                            // }
                        },
                        bmap: {
                            center: [116.343376,39.947735],
                            zoom: 16,
                            roam: true,
                            mapStyle: {
                                        styleJson: [
                            {
                                        'featureType': 'land',     //调整土地颜色
                                        'elementType': 'geometry',
                                        'stylers': {
                                                'color': '#081734'
                                        }
                            },
                            {
                                        'featureType': 'building',   //调整建筑物颜色
                                        'elementType': 'geometry',
                                        'stylers': {
                                                'color': '#04406F'
                                        }
                            },
                            {
                                        'featureType': 'building',   //调整建筑物标签是否可视
                                        'elementType': 'labels',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'highway',     //调整高速道路颜色
                                        'elementType': 'geometry',
                                        'stylers': {
                                        'color': '#015B99'
                                        }
                            },
                            {
                                        'featureType': 'highway',    //调整高速名字是否可视
                                        'elementType': 'labels',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'arterial',   //调整一些干道颜色
                                        'elementType': 'geometry',
                                        'stylers': {
                                        'color':'#003051'
                                        }
                            },
                            {
                                        'featureType': 'arterial',
                                        'elementType': 'labels',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'green',
                                        'elementType': 'geometry',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'water',
                                        'elementType': 'geometry',
                                        'stylers': {
                                                'color': '#044161'
                                        }
                            },
                            {
                                        'featureType': 'subway',    //调整地铁颜色
                                        'elementType': 'geometry.stroke',
                                        'stylers': {
                                        'color': '#003051'
                                        }
                            },
                            {
                                        'featureType': 'subway',
                                        'elementType': 'labels',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'railway',
                                        'elementType': 'geometry',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'railway',
                                        'elementType': 'labels',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'all',     //调整所有的标签的边缘颜色
                                        'elementType': 'labels.text.stroke',
                                        'stylers': {
                                                'color': '#313131'
                                        }
                            },
                            {
                                        'featureType': 'all',     //调整所有标签的填充颜色
                                        'elementType': 'labels.text.fill',
                                        'stylers': {
                                                'color': '#FFFFFF'
                                        }
                            },
                            {
                                        'featureType': 'manmade',   
                                        'elementType': 'geometry',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'manmade',
                                        'elementType': 'labels',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'local',
                                        'elementType': 'geometry',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'local',
                                        'elementType': 'labels',
                                        'stylers': {
                                        'visibility': 'off'
                                        }
                            },
                            {
                                        'featureType': 'subway',
                                        'elementType': 'geometry',
                                        'stylers': {
                                                'lightness': -65
                                        }
                            },
                            {
                                        'featureType': 'railway',
                                        'elementType': 'all',
                                        'stylers': {
                                                'lightness': -40
                                        }
                            },
                            {
                                        'featureType': 'boundary',
                                        'elementType': 'geometry',
                                        'stylers': {
                                                'color': '#8b8787',
                                                'weight': '1',
                                                'lightness': -29
                                        }
                            }]
                            }
                        },
                        visualMap: {
                        min: 0,
                        max: 200,
                        splitNumber:4,
                        inRange: {
                            color: ['blue', 'green', 'yellow', 'red']
                        },
                        textStyle: {
                            color: '#fff'
                        },
                        bottom:100
                        },
                        series: [{
                            type: 'heatmap',
                            mapType: 'china',
                            coordinateSystem: 'bmap',
                            blurSize:50,
                            data:[]
                        }]
                    },
                    options: [
                        {
                            series:[{
                                data :convertData(data)
                            }]
                        }
                    ]
                }
                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
                //更多地图选项         
                // var bmap = myChart.getModel().getComponent('bmap').getBMap();
                // bmap.addControl(new BMap.MapTypeControl());
                //console.log(convertData(value,100));
               }     
                var time=JSON.stringify({
                        startTime:"2018-05-15 00:00",
                        endTime:"2018-05-17 00:00"
                })
              $.ajax({
                  type:'POST',
                  url:'http://www.zooseefun.net/Report_Forms/getReportFormsByTime',
                  data:{time:time},
                  success:function(data){
                        console.log(data);
                  }
              })
            var data=[{"Lon":"116.349342","Time":"2018-05-15 10:21:00.0","animalId":26,"count":"50","lat":"39.948392","location":"猫科动物馆","name":"狞猫","reportId":115},{"Lon":"116.349342","Time":"2018-05-15 10:22:00.0","animalId":6,"count":"300","lat":"39.948392","location":"猫科动物馆","name":"猎豹","reportId":116},{"Lon":"116.346876","Time":"2018-05-15 20:50:00.0","animalId":16,"count":"300","lat":"39.94602","location":"夜行动物馆","name":"小熊猫","reportId":117},{"Lon":"116.348897","Time":"2018-05-15 21:10:00.0","animalId":7,"count":"100","lat":"39.945216","location":"猴山","name":"猕猴","reportId":118},{"Lon":"116.34084","Time":"2018-05-15 21:22:00.0","animalId":1,"count":"150","lat":"39.948398","location":"长颈鹿馆","name":"长颈鹿","reportId":119}]
            var convertData = function (data,n) {
                    var res = [];
                    for (var i = 0; i < data.length; i++) {
                        // var geoCoord = geoCoordMap[data[i].name];
                        // if (geoCoord) {
                        //     res.push(geoCoord.concat(data[i].value+ (Math.random()-0.5)*n ));
                        // }
                        // console.log(geoCoord.concat(data[i].value+ (Math.random()-0.5)*n ));
                        var arr=[parseFloat(data[i].Lon),parseFloat(data[i].lat),parseFloat(data[i].count)];
                        res.push(arr);
                        console.log(data.length);
                    }
                    console.log(res);
                    return res;
            };
            drawHeartMap();
            console.log(data);
    
        </script>
</body>
</html>